#[
    This file is a part of the RailDriver project.
    Copyright Â© 2022, Cassandra "ZZ Cat" Robinson. All rights reserved.
]#

@name RailDriver/lib/smartEntityManagement

function void semLockE2()
{
    local E = entity()
    local LockE2 = 0

    if (isSinglePlayer() != 0)
    {
        LockE2 = 0
    }

    else
    {
        LockE2 = 1
    }

    E:propNotSolid(LockE2)
    E:propDraw(!LockE2)
    E:propShadow(!LockE2)
}

function number semSmartParentE2toLocoBody()
{
    local E = entity()

    if (!E:parent())
    {
        local W = E:isWeldedTo()
        if (W:isValid() == 0 | !W)
        {
            return 0
        }

        E:constraintBreak("weld", W)
        E:parentTo(W)
    }

    return 1
}

function array semSmartDiscoverLocoTrucks()
{
    local E = entity()
    local P = E:parent()
    local CE = getConnectedEntities("axis")

    if (!CE[1, entity] | !CE[1, entity]:isValid())
    {
        return array()
    }

    else
    {
        CE:remove(1)
        if (CE:count() == 0)
        {
            return array()
        }

        else
        {
            local Ret = array()
            for (I = 1, CE:count())
            {
                if (P:toLocal(CE[I, entity]:pos()):x() < 0)
                {
                    Ret[1, entity] = CE[I, entity]
                }

                else
                {
                    Ret[2, entity] = CE[I, entity]
                }
            }

            return Ret
        }
    }
}